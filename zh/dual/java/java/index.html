<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="tataba">
  
  <link rel="shortcut icon" href="../../../../favicon.ico">
  
  <title>JAVA - Onbon Docs</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../../../css/theme.css" />
  <link rel="stylesheet" href="../../../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  <link href="../../../../css/my.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "JAVA";
    var mkdocs_page_input_path = "zh\\dual\\java\\java.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../../../.." class="icon icon-home"> Onbon Docs</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../../..">主页</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">单双色系列</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../../dual/">开发指南</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">JAVA</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#1">1. 平台支持</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#2-sdk">2. 获取 SDK</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#3">3. 使用说明</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#31-sdk">3.1 SDK初始化</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#32-screen">3.2 Screen类</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#33">3.3 屏幕连接</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#34">3.4 屏幕控制</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#341">3.4.1 开关机</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#342">3.4.2 校正时钟</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#343">3.4.3 锁定屏幕</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#344">3.4.4 锁定节目</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#345">3.4.5 查询固件版本</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#346">3.4.6 获取控制器状态</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#35">3.5 节目与区域</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#26">2.6 动态区</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#27-servergprs">2.7 Server模式（包含GPRS）</a>
    </li>
        </ul>
    </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../c/c/">C</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">常用工具</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../../tool/wireshark/">网络抓包</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../../../about/">关于我们</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../..">Onbon Docs</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../..">Docs</a> &raquo;</li>
    
      
        
          <li>单双色系列 &raquo;</li>
        
      
    
    <li>JAVA</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/onbonlab/onbonlab.github.io.git/edit/master/docs/zh/dual/java/java.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="java-sdk">JAVA SDK 使用说明<a class="headerlink" href="#java-sdk" title="Permanent link">&para;</a></h1>
<h2 id="1">1. 平台支持<a class="headerlink" href="#1" title="Permanent link">&para;</a></h2>
<p>JAVA SDK 在设计过程中，充分考虑了跨平台的需求。本 SDK 可以支持 windows/linux/android 操作系统，同时支持网络与串口通讯。而且在不同平台下，所有的操作都拥有统一的接口。</p>
<h2 id="2-sdk">2. 获取 SDK<a class="headerlink" href="#2-sdk" title="Permanent link">&para;</a></h2>
<p>a. windows/linux demo: </p>
<p><a href="https://doc.onbonbx.com/">https://doc.onbonbx.com/</a></p>
<p>b. android demo: </p>
<p><a href="https://doc.onbonbx.com/">https://doc.onbonbx.com/</a></p>
<h2 id="3">3. 使用说明<a class="headerlink" href="#3" title="Permanent link">&para;</a></h2>
<p>对于五代和六代控制器，我们提供了不同的 JAR 包，而其接口定义遵循了相同的命名规则，五代控制器的接口通常命名为 Bx5Gxxxx, 而相对应的六代控制器通常命名为 Bx6Gxxx。而以下接口说明中，为了简便只提到了五代SDK的接口，而六代SDK的接口，可根据命名规则自行推断或查看SDK中附带的相应的 JAVADOC 文档。</p>
<h3 id="31-sdk">3.1 SDK初始化<a class="headerlink" href="#31-sdk" title="Permanent link">&para;</a></h3>
<p>在使用 SDK 之前，必需先对整个 SDK 进行初始化。而初始化操作，在整个应用中只能进行一次（<strong>注: 非常重要</strong>)。如果反复调用 initial() 接口，会导致系统的 cpu load 变高。其调用方法如下：</p>
<p><strong>五代控制器</strong></p>
<p><div class="codehilite"><pre><span></span><code><span class="c1">// 五代控制器</span>
<span class="c1">// 初始化SDK</span>
<span class="c1">// 初始化有3种方法，如下</span>
<span class="n">Bx5GEnv</span><span class="p">.</span><span class="na">initial</span><span class="p">();</span>
<span class="c1">// log.properties是日志配置文件</span>
<span class="n">Bx5GEnv</span><span class="p">.</span><span class="na">initial</span><span class="p">(</span><span class="s">&quot;log.properties&quot;</span><span class="p">);</span> 
<span class="c1">// 30000为通讯超时时间，单位是毫秒</span>
<span class="n">Bx6GEnv</span><span class="p">.</span><span class="na">initial</span><span class="p">(</span><span class="s">&quot;log.properties&quot;</span><span class="p">,</span><span class="mi">30000</span><span class="p">);</span>
</code></pre></div>
<strong>六代控制器</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// 六代控制卡</span>
<span class="c1">// 初始化SDK</span>
<span class="c1">// 初始化有3种方法，如下</span>
<span class="n">Bx6GEnv</span><span class="p">.</span><span class="na">initial</span><span class="p">();</span>
<span class="c1">// log.properties是日志配置文件</span>
<span class="n">Bx6GEnv</span><span class="p">.</span><span class="na">initial</span><span class="p">(</span><span class="s">&quot;log.properties&quot;</span><span class="p">);</span>
<span class="c1">// 30000为通讯超时时间，单位是毫秒</span>
<span class="n">Bx6GEnv</span><span class="p">.</span><span class="na">initial</span><span class="p">(</span><span class="s">&quot;log.properties&quot;</span><span class="p">,</span><span class="mi">30000</span><span class="p">);</span>
</code></pre></div>

<h3 id="32-screen">3.2 Screen类<a class="headerlink" href="#32-screen" title="Permanent link">&para;</a></h3>
<p>要SDK中与控制器的所有交互都需要通过Bx5GScreen类或其子类来进行，其子类包括：
Bx5GScreenClient（client模式使用），Bx5GScreenRS（串口模式使用），Bx5GScreenServer（server模式使用）。创建screen对象的通常代码如下：</p>
<p><strong>五代控制器</strong>
<div class="codehilite"><pre><span></span><code><span class="c1">// 五代控制器</span>
<span class="c1">// 创建screen对象，用于对控制器进行访问，客户端模式</span>
<span class="n">Bx5GScreenClient</span> <span class="n">screen</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Bx5GScreenClient</span><span class="p">(</span><span class="s">&quot;MyScreen&quot;</span><span class="p">);</span>
<span class="c1">// 创建screen对象，用于对控制器进行访问，串口模式</span>
<span class="n">Bx5GScreenRS</span> <span class="n">screen</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Bx5GScreenRS</span><span class="p">(</span><span class="s">&quot;MyScreen&quot;</span><span class="p">);</span>
</code></pre></div>
<strong>六代控制器</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// 六代控制器创建screen对象方法，以BX-6M系列为例</span>
<span class="c1">// Bx6M 为控制卡型号，只有型号对应才能通讯正常，否则会出现逾时未回应</span>
<span class="c1">// 如果使用的控制器型号在SDK中没有定义，则用Bx6M替代</span>
<span class="c1">// 创建screen对象，用于对控制器进行访问，客户端模式</span>
<span class="n">Bx6GScreenClient</span> <span class="n">screen</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Bx6GScreenClient</span><span class="p">(</span><span class="s">&quot;MyScreen&quot;</span><span class="p">,</span><span class="k">new</span> <span class="n">Bx6M</span><span class="p">());</span>
<span class="c1">// 创建screen对象，用于对控制器进行访问，串口模式</span>
<span class="n">Bx6GScreenRS</span> <span class="n">screen</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Bx6GScreenRS</span><span class="p">(</span><span class="s">&quot;MyScreen&quot;</span><span class="p">,</span><span class="k">new</span> <span class="n">Bx6M</span><span class="p">());</span>
</code></pre></div>

<h3 id="33">3.3 屏幕连接<a class="headerlink" href="#33" title="Permanent link">&para;</a></h3>
<p>在对控制器交互之前，需要先与控制器建立连接，代码如下：
<div class="codehilite"><pre><span></span><code><span class="c1">// 连接控制器</span>
<span class="c1">// 其中，192.168.100.199为控制器的实际IP地址，请根据实际情况填写</span>
<span class="c1">// 端口号默认为5005</span>
<span class="c1">// 五代控制器和六代控制器屏幕连接方法一样</span>
<span class="n">screen</span><span class="p">.</span><span class="na">connect</span><span class="p">(</span><span class="s">&quot;192.168.100.199&quot;</span><span class="p">,</span><span class="mi">5005</span><span class="p">);</span>
</code></pre></div>
与控制器交互完成后，需断开与控制器之间的连接，其代码如下：
<div class="codehilite"><pre><span></span><code><span class="c1">// 断开与控制器之间的连接</span>
<span class="n">screen</span><span class="p">.</span><span class="na">disconnect</span><span class="p">();</span>
</code></pre></div>
<strong>注1：connect 与 disconnect 必需成对出现，通讯结束时一定要记得断开连接</strong></p>
<p><strong>注2：如果不知道控制器IP地址，请先使用LedshowTW软件设置IP地址，软件下载地址：<a href="https://www.onbonbx.com/download/165.html">https://www.onbonbx.com/download/165.html</a></strong></p>
<h3 id="34">3.4 屏幕控制<a class="headerlink" href="#34" title="Permanent link">&para;</a></h3>
<p>SDK 还提供了一些接口，用于对 屏幕进行一些常用操作。</p>
<h4 id="341">3.4.1 开关机<a class="headerlink" href="#341" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="c1">// 关机</span>
<span class="n">screen</span><span class="p">.</span><span class="na">turnOff</span><span class="p">();</span>
<span class="c1">// 开机</span>
<span class="n">screen</span><span class="p">.</span><span class="na">turnOn</span><span class="p">();</span>
</code></pre></div>

<h4 id="342">3.4.2 校正时钟<a class="headerlink" href="#342" title="Permanent link">&para;</a></h4>
<p>控制器上的时钟不准确时，可以通过此命令对其进行校正。</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// 校时</span>
<span class="n">screen</span><span class="p">.</span><span class="na">syncTime</span><span class="p">();</span>
</code></pre></div>

<h4 id="343">3.4.3 锁定屏幕<a class="headerlink" href="#343" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="c1">// 锁定屏幕当前画面</span>
<span class="n">screen</span><span class="p">.</span><span class="na">lock</span><span class="p">();</span>
<span class="c1">// 解除锁定屏幕当前画面</span>
<span class="n">screen</span><span class="p">.</span><span class="na">unlock</span><span class="p">();</span>
</code></pre></div>

<p>屏幕锁定后，画面将被锁定不动。</p>
<h4 id="344">3.4.4 锁定节目<a class="headerlink" href="#344" title="Permanent link">&para;</a></h4>
<p>节目锁定后，控制器将仅播放当前锁定的节目，不再轮播其它节目。</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// 锁定指定节目</span>
<span class="n">screen</span><span class="p">.</span><span class="na">lockProgram</span><span class="p">(</span><span class="n">programId</span><span class="p">,</span> <span class="n">lockDuration</span><span class="p">);</span>
<span class="c1">// 解除节目锁定</span>
<span class="n">screen</span><span class="p">.</span><span class="na">unlockProgram</span><span class="p">(</span><span class="n">programId</span><span class="p">);</span>
</code></pre></div>

<p>其中，</p>
<p>programId - 节目的 id</p>
<p>lockDuration - 锁定的时间长度，如果为0，则一直锁定</p>
<h4 id="345">3.4.5 查询固件版本<a class="headerlink" href="#345" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="c1">// 查询控制器当前固件版本</span>
<span class="n">screen</span><span class="p">.</span><span class="na">checkFirmware</span><span class="p">();</span>
</code></pre></div>

<h4 id="346">3.4.6 获取控制器状态<a class="headerlink" href="#346" title="Permanent link">&para;</a></h4>
<p>控制器状态中，包含连接在控制器上的传感器的值。如下所示：</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// 通过以下接口回读控制器状态</span>
<span class="n">Bx5GScreen</span><span class="p">.</span><span class="na">Result</span><span class="o">&lt;</span><span class="n">ReturnControllersStatus</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">screen</span><span class="p">.</span><span class="na">checkControllerStatus</span><span class="p">();</span>
<span class="k">if</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">isOK</span><span class="p">()){</span>
    <span class="n">ReturnControllerStatus</span> <span class="n">status</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="na">reply</span><span class="p">;</span>
    <span class="c1">// 取得亮度值</span>
    <span class="n">status</span><span class="p">.</span><span class="na">getBrightness</span><span class="p">();</span>
    <span class="c1">// 取得温度传感器温度值</span>
    <span class="n">status</span><span class="p">.</span><span class="na">getTemperature1</span><span class="p">();</span>
    <span class="c1">// status还有很多接口，根据实际应用进行调用</span>
    <span class="p">...</span>
<span class="p">}</span>
<span class="k">else</span><span class="p">{</span>
    <span class="n">ErrorType</span> <span class="n">error</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="na">getError</span><span class="p">();</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">error</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="35">3.5 节目与区域<a class="headerlink" href="#35" title="Permanent link">&para;</a></h3>
<p>节目主要用于组合屏幕上现实的内容，它由多个区域组成。控制器同一时间只能播放一个集美，它是控制器现实内容可以单独更新的最小单位。
以下，我们将按步骤创建一个节目，并将其发送到控制器进行显示</p>
<p><div class="codehilite"><pre><span></span><code><span class="c1">// 创建节目文件</span>
<span class="c1">// 第二个参数为显示屏属性，具体可以参照Bx5GScreenProfile类</span>
<span class="n">Bx5GScreenProfile</span> <span class="n">profile</span> <span class="o">=</span> <span class="n">screen</span><span class="p">.</span><span class="na">getProfile</span><span class="p">();</span>
<span class="n">ProgramBxFile</span> <span class="n">p0</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProgramBxFile</span><span class="p">(</span><span class="s">&quot;P000&quot;</span><span class="p">,</span><span class="n">profile</span><span class="p">);</span>
<span class="c1">// 关于节目类的其他接口可以参考ProgramBxFile类</span>
</code></pre></div>
控制器支持的区域有很多种，例如：图文区、时间区、传感器区等。其中，最常用的是图文区。图文区可以支持显示文本和图片，文字或图片可以按数据也依次添加到图文区中，每页数据均可以设置特技方式，停留时间等属性
创建图文区的步骤大致如下：
创建TextCaptionBxArea对象
创建TextBxPage或ImageFileBxPage对象
将创建好的page对象添加到TextCaptionBxArea中
如下代码，创建一个文本区，并向这个区域中添加一个文本页
<div class="codehilite"><pre><span></span><code><span class="c1">// 创建一个图文区</span>
<span class="c1">// 参数为X、Y、width、heigth</span>
<span class="c1">// 注意区域左边和宽度高度，不要越界</span>
<span class="n">TextCaptionBxArea</span> <span class="n">area</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TextCaptionBxArea</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">160</span><span class="p">,</span><span class="mi">64</span><span class="p">);</span>
<span class="c1">// 创建一个数据页，并希望显示“仰邦科技”这几个字</span>
<span class="n">TextBxPage</span> <span class="n">page</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TextBxPage</span><span class="p">(</span><span class="s">&quot;仰邦科技&quot;</span><span class="p">);</span>
<span class="c1">// 将page添加到area中</span>
<span class="n">area</span><span class="p">.</span><span class="na">addPage</span><span class="p">(</span><span class="n">page</span><span class="p">);</span>
<span class="c1">// 将图文区添加到节目中</span>
<span class="n">p0</span><span class="p">.</span><span class="na">addArea</span><span class="p">(</span><span class="n">area</span><span class="p">);</span>
</code></pre></div>
关于时间区
时间区的创建过程大致如下：
创建DateTimeBxArea对象
设置各时间单元显示格式
将DateTimeBxArea添加到节目中
<div class="codehilite"><pre><span></span><code><span class="c1">// 下面代码创建了一个时间区</span>
<span class="c1">// 注意：只需输入时间区的起始坐标，区域的宽度和高度SDK会根据字体和显示方式自动计算</span>
<span class="n">DateTimeBxArea</span> <span class="n">dtArea</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DateTimeBxArea</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">screen</span><span class="p">.</span><span class="na">getProfile</span><span class="p">());</span>
<span class="c1">// 设置字体</span>
<span class="n">dtArea</span><span class="p">.</span><span class="na">setFont</span><span class="p">(</span><span class="k">new</span> <span class="n">Font</span><span class="p">(</span><span class="s">&quot;宋体&quot;</span><span class="p">,</span><span class="n">Font</span><span class="p">.</span><span class="na">PLAIN</span><span class="p">,</span><span class="mi">12</span><span class="p">));</span>
<span class="c1">// 设置显示颜色</span>
<span class="n">dtArea</span><span class="p">.</span><span class="na">setForeground</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="na">yellow</span><span class="p">);</span>
<span class="c1">// 多行显示还是单行显示</span>
<span class="n">dtArea</span><span class="p">.</span><span class="na">setMultiline</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="c1">// 年月日显示格式</span>
<span class="c1">// 如果不需要显示，设置为null</span>
<span class="n">dtArea</span><span class="p">.</span><span class="na">setDateStyle</span><span class="p">(</span><span class="n">DateStyle</span><span class="p">.</span><span class="na">YYY_MM_DD_1</span><span class="p">);</span>
<span class="n">dtArea</span><span class="p">.</span><span class="na">setTimeStyle</span><span class="p">(</span><span class="n">TimeStyle</span><span class="p">.</span><span class="na">HH_MM_SS_1</span><span class="p">);</span>
<span class="n">dtArea</span><span class="p">.</span><span class="na">setWeekStyle</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<span class="c1">// 将时间区添加到节目中</span>
<span class="n">p0</span><span class="p">.</span><span class="na">addArea</span><span class="p">(</span><span class="n">dtArea</span><span class="p">);</span>
<span class="c1">// 关于DateTimeBxArea类的更多接口，请参考JAVADOC中相关类的说明</span>
</code></pre></div>
更新节目
<div class="codehilite"><pre><span></span><code><span class="c1">// 以下为更新节目命令</span>
<span class="n">screen</span><span class="p">.</span><span class="na">WriteProgram</span><span class="p">(</span><span class="n">p0</span><span class="p">);</span>
<span class="c1">// 更新节目还有很多命令，请参考JAVADOC</span>
</code></pre></div></p>
<h3 id="26">2.6 动态区<a class="headerlink" href="#26" title="Permanent link">&para;</a></h3>
<p>动态区是一种比较特殊的区域，其有以下几个主要特点：
* 更新次数没有限制
* 内容掉电不保存
* 独立于节目进行编辑
* 可以支持多个区域，且每个区域可以进行单独更新
* 可以和单个活多个节目绑定显示，即作为节目的一个区域进行显示
* 可以作为单独一个节目进行独立播放
* 灵活的控制方式：超时时间控制、是否立即显示灯</p>
<p>以下为动态区代码
<div class="codehilite"><pre><span></span><code>// 五代控制器动态区（BX-5E系列）
// BX-5E系列控制卡最高支持4个动态区，当屏幕上需要同时显示多个动态区时，动态区ID不可以相同
// DynamicBxRule(id,runMode,immediatePlay,timeout);
// runMode 运行模式
// 0:循环显示
// 1:显示完成后静止显示最后一页数据
// 2:循环显示，超过设定时间后数据仍未更新时不显示
// 3:循环显示，超过设定时间后数据仍未更新时显示Logo信息
// 4:循环显示，显示完最后一页后不再显示
// immediatePlay
// 0:与异步节目一起播放
// 1:异步节目停止播放，仅播放动态区
// 2:当播放完节目编号最高的异步节目后播放该动态区
DynamicBxAreaRule rule = new DynamicBxRule(0,(byte)0,(byte)1,0);
TextCaptionBxArea darea = new TextCaptionBxArea(0,0,160,64,screen.getProfile());
TextBxPage dapge = new TextBxPage(&quot;动态区123abc&quot;);
darea.addPage(dpage);
screen.writeDynamic(rule,darea);

// 六代控制器动态区
DynamicBxAreaRule rule = new DynamicBxAreaRule();
// 设定动态区ID，此处ID为0，多个动态区ID不能相同
rule.setId(0);
// 设定异步节目停止播放，仅播放动态区
// 0:动态区与异步节目一起播放
// 1:异步节目停止播放，仅播放动态区
// 2:当播放完节目编号最高的异步节目后播放该动态区
rule.setImmediatePlay((byte)1);
// 设定动态区循环播放
// 0:循环播放
// 1:显示完成后静置显示最后一页数据
// 2:循环显示，超过设定时间后仍未更新时不再显示
// 3:循环显示，超过设定时间后仍未更新时显示Logo信息
// 4:显示完成最后一页后就不再显示
rule.setRunMode((byte)0);
DynamicBxArea area = new DynamicBxArea(0,0,160,32,screen.getProfile());
TextBxPage page = new TextBxPage(&quot;动态区abc&quot;);
area.addPage(page);
screen.writeDynamic(rule,area);
</code></pre></div></p>
<h3 id="27-servergprs">2.7 Server模式（包含GPRS）<a class="headerlink" href="#27-servergprs" title="Permanent link">&para;</a></h3>
<p>Server使用流程如下：
* 初始化API（在一个进程内只需要初始化一次）
* 建立服务器
* 设定监听等待屏幕的连线与断线事件
* 关闭服务器</p>
<p>主要代码如下：
<div class="codehilite"><pre><span></span><code><span class="n">Bx5GEnv</span><span class="p">.</span><span class="na">initial</span><span class="p">();</span> <span class="c1">//初始化</span>
<span class="c1">// 建立服务器</span>
<span class="n">Bx5GServer</span> <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Bx5GServer</span><span class="p">(</span><span class="s">&quot;Hello Screen&quot;</span><span class="p">,</span> <span class="mi">8036</span><span class="p">);</span>
<span class="c1">// 添加监听</span>
<span class="n">server</span><span class="p">.</span><span class="na">addListener</span><span class="p">(</span><span class="k">new</span> <span class="n">ConnectionListener</span><span class="p">());</span>
<span class="c1">// 启动服务器</span>
<span class="n">server</span><span class="p">.</span><span class="na">start</span><span class="p">();</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;waiting 30 secs&quot;</span><span class="p">);</span>
<span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="mi">30000</span><span class="p">);</span>
<span class="c1">// 更新节目或者动态区</span>
<span class="c1">//</span>
<span class="c1">//</span>
<span class="c1">//</span>


<span class="c1">// 关闭服务器</span>
<span class="n">server</span><span class="p">.</span><span class="na">stop</span><span class="p">();</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;done!&quot;</span><span class="p">);</span>

<span class="c1">// 监听</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ConnectionListener</span> <span class="kd">implements</span> <span class="n">Bx5GServerListener</span> <span class="p">{</span>
<span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">connected</span><span class="p">(</span><span class="n">String</span> <span class="n">socketId</span><span class="p">,</span> <span class="n">String</span> <span class="n">controllerAddr</span><span class="p">,</span>
<span class="n">Bx5GScreen</span> <span class="n">screen</span><span class="p">)</span> <span class="p">{</span>
<span class="n">Result</span><span class="o">&lt;</span><span class="n">ReturnPingStatus</span><span class="o">&gt;</span> <span class="n">result1</span> <span class="o">=</span> <span class="n">screen</span><span class="p">.</span><span class="na">ping</span><span class="p">();</span>
<span class="n">Result</span><span class="o">&lt;</span><span class="n">ReturnControllerStatus</span><span class="o">&gt;</span> <span class="n">result2</span> <span class="o">=</span>
<span class="n">screen</span><span class="p">.</span><span class="na">checkControllerStatus</span><span class="p">();</span>
<span class="p">...</span>
<span class="p">}</span>
<span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">disconnected</span><span class="p">(</span><span class="n">String</span> <span class="n">socketId</span><span class="p">,</span> <span class="n">String</span> <span class="n">controllerAddr</span><span class="p">,</span>
<span class="n">Bx5GScreen</span> <span class="n">screen</span><span class="p">)</span> <span class="p">{</span>
<span class="p">...</span>
<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../c/c/" class="btn btn-neutral float-right" title="C">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../../dual/" class="btn btn-neutral" title="开发指南"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright © 2020 onbon. All rights reserved. </p>
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/onbonlab/onbonlab.github.io.git/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../../dual/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../../c/c/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../../../..';</script>
    <script src="../../../../js/theme.js" defer></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
      <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js" defer></script>
      <script src="../../../../js/my.js" defer></script>
      <script src="../../../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
