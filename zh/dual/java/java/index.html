<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="tataba">
  
  <link rel="shortcut icon" href="../../../../favicon.ico">
  
  <title>JAVA - Onbon Docs</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../../../css/theme.css" />
  <link rel="stylesheet" href="../../../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  <link href="../../../../css/my.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "JAVA";
    var mkdocs_page_input_path = "zh\\dual\\java\\java.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../../../.." class="icon icon-home"> Onbon Docs</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../../..">主页</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">单双色系列</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../../dual/">开发指南</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">JAVA</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#1">1. 平台支持</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#2-sdk">2. 获取 SDK</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#3">3. 使用说明</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#31-sdk">3.1 SDK初始化</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#32-screen">3.2 Screen类</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#33">3.3 屏幕连接</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#34">3.4 屏幕控制</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#341">3.4.1 开关机</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#342">3.4.2 校正时钟</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#343">3.4.3 锁定屏幕</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#344">3.4.4 锁定节目</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#345">3.4.5 查询固件版本</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#346">3.4.6 获取控制器状态</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#35">3.5 节目与区域</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#36">3.6 动态区</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#4-server">4. Server模式</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#41">4.1 模式简介</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#42-demo">4.2 Demo说明</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#5-android">5. Android平台</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#51">5.1 使用说明</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#52-sdkdemo">5.2 获取SDK与DEMO</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#6">6. 常见问题</a>
    </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../c/c/">C</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">常用工具</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../../tool/wireshark/">网络抓包</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../../../about/">关于我们</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../..">Onbon Docs</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../..">Docs</a> &raquo;</li>
    
      
        
          <li>单双色系列 &raquo;</li>
        
      
    
    <li>JAVA</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/onbonlab/onbonlab.github.io.git/edit/master/docs/zh/dual/java/java.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="java-sdk">JAVA SDK 使用说明<a class="headerlink" href="#java-sdk" title="Permanent link">&para;</a></h1>
<h2 id="1">1. 平台支持<a class="headerlink" href="#1" title="Permanent link">&para;</a></h2>
<p>JAVA SDK 在设计过程中，充分考虑了跨平台的需求。本 SDK 可以支持 windows/linux/android 操作系统，同时支持网络与串口通讯。而且在不同平台下，所有的操作都拥有统一的接口。</p>
<h2 id="2-sdk">2. 获取 SDK<a class="headerlink" href="#2-sdk" title="Permanent link">&para;</a></h2>
<p>a. windows/linux demo: </p>
<p><a href="https://doc.onbonbx.com/">https://doc.onbonbx.com/</a></p>
<p>b. android demo: </p>
<p><a href="https://github.com/onbonlab/bx.dual.android.git">https://github.com/onbonlab/bx.dual.android.git</a></p>
<p>c. android 串口通讯 sdk 与 demo:</p>
<p><a href="https://github.com/onbonlab/bx.dual.android.serial.git">https://github.com/onbonlab/bx.dual.android.serial.git</a></p>
<h2 id="3">3. 使用说明<a class="headerlink" href="#3" title="Permanent link">&para;</a></h2>
<p>对于五代和六代控制器，我们提供了不同的 JAR 包，而其接口定义遵循了相同的命名规则，五代控制器的接口通常命名为 Bx5Gxxxx, 而相对应的六代控制器通常命名为 Bx6Gxxx。而以下接口说明中，为了简便只提到了五代SDK的接口，而六代SDK的接口，可根据命名规则自行推断或查看SDK中附带的相应的 JAVADOC 文档。</p>
<h3 id="31-sdk">3.1 SDK初始化<a class="headerlink" href="#31-sdk" title="Permanent link">&para;</a></h3>
<p>在使用 SDK 之前，必需先对整个 SDK 进行初始化。而初始化操作，在整个应用中只能进行一次（<strong>注: 非常重要</strong>)。如果反复调用 initial() 接口，会导致系统的 cpu load 变高。其调用方法如下：</p>
<p><strong>五代控制器</strong></p>
<p><div class="codehilite"><pre><span></span><code><span class="c1">// 五代控制器</span>
<span class="c1">// 初始化SDK</span>
<span class="c1">// 初始化有3种方法，如下</span>
<span class="n">Bx5GEnv</span><span class="p">.</span><span class="na">initial</span><span class="p">();</span>
<span class="c1">// log.properties是日志配置文件</span>
<span class="n">Bx5GEnv</span><span class="p">.</span><span class="na">initial</span><span class="p">(</span><span class="s">&quot;log.properties&quot;</span><span class="p">);</span> 
<span class="c1">// 30000为通讯超时时间，单位是毫秒</span>
<span class="n">Bx6GEnv</span><span class="p">.</span><span class="na">initial</span><span class="p">(</span><span class="s">&quot;log.properties&quot;</span><span class="p">,</span><span class="mi">30000</span><span class="p">);</span>
</code></pre></div>
<strong>六代控制器</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// 六代控制卡</span>
<span class="c1">// 初始化SDK</span>
<span class="c1">// 初始化有3种方法，如下</span>
<span class="n">Bx6GEnv</span><span class="p">.</span><span class="na">initial</span><span class="p">();</span>
<span class="c1">// log.properties是日志配置文件</span>
<span class="n">Bx6GEnv</span><span class="p">.</span><span class="na">initial</span><span class="p">(</span><span class="s">&quot;log.properties&quot;</span><span class="p">);</span>
<span class="c1">// 30000为通讯超时时间，单位是毫秒</span>
<span class="n">Bx6GEnv</span><span class="p">.</span><span class="na">initial</span><span class="p">(</span><span class="s">&quot;log.properties&quot;</span><span class="p">,</span><span class="mi">30000</span><span class="p">);</span>
</code></pre></div>

<h3 id="32-screen">3.2 Screen类<a class="headerlink" href="#32-screen" title="Permanent link">&para;</a></h3>
<p>要SDK中与控制器的所有交互都需要通过Bx5GScreen类或其子类来进行，其子类包括：
Bx5GScreenClient（client模式使用），Bx5GScreenRS（串口模式使用），Bx5GScreenServer（server模式使用）。创建screen对象的通常代码如下：</p>
<p><strong>五代控制器</strong>
<div class="codehilite"><pre><span></span><code><span class="c1">// 五代控制器</span>
<span class="c1">// 创建screen对象，用于对控制器进行访问，客户端模式</span>
<span class="n">Bx5GScreenClient</span> <span class="n">screen</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Bx5GScreenClient</span><span class="p">(</span><span class="s">&quot;MyScreen&quot;</span><span class="p">);</span>
<span class="c1">// 创建screen对象，用于对控制器进行访问，串口模式</span>
<span class="n">Bx5GScreenRS</span> <span class="n">screen</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Bx5GScreenRS</span><span class="p">(</span><span class="s">&quot;MyScreen&quot;</span><span class="p">);</span>
</code></pre></div>
<strong>六代控制器</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// 六代控制器创建screen对象方法，以BX-6M系列为例</span>
<span class="c1">// Bx6M 为控制卡型号，只有型号对应才能通讯正常，否则会出现逾时未回应</span>
<span class="c1">// 如果使用的控制器型号在SDK中没有定义，则用Bx6M替代</span>
<span class="c1">// 创建screen对象，用于对控制器进行访问，客户端模式</span>
<span class="n">Bx6GScreenClient</span> <span class="n">screen</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Bx6GScreenClient</span><span class="p">(</span><span class="s">&quot;MyScreen&quot;</span><span class="p">,</span><span class="k">new</span> <span class="n">Bx6M</span><span class="p">());</span>
<span class="c1">// 创建screen对象，用于对控制器进行访问，串口模式</span>
<span class="n">Bx6GScreenRS</span> <span class="n">screen</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Bx6GScreenRS</span><span class="p">(</span><span class="s">&quot;MyScreen&quot;</span><span class="p">,</span><span class="k">new</span> <span class="n">Bx6M</span><span class="p">());</span>
</code></pre></div>

<h3 id="33">3.3 屏幕连接<a class="headerlink" href="#33" title="Permanent link">&para;</a></h3>
<p>在对控制器交互之前，需要先与控制器建立连接，代码如下：
<div class="codehilite"><pre><span></span><code><span class="c1">// 连接控制器</span>
<span class="c1">// 其中，192.168.100.199为控制器的实际IP地址，请根据实际情况填写</span>
<span class="c1">// 端口号默认为5005</span>
<span class="c1">// 五代控制器和六代控制器屏幕连接方法一样</span>
<span class="n">screen</span><span class="p">.</span><span class="na">connect</span><span class="p">(</span><span class="s">&quot;192.168.100.199&quot;</span><span class="p">,</span><span class="mi">5005</span><span class="p">);</span>
</code></pre></div>
与控制器交互完成后，需断开与控制器之间的连接，其代码如下：
<div class="codehilite"><pre><span></span><code><span class="c1">// 断开与控制器之间的连接</span>
<span class="n">screen</span><span class="p">.</span><span class="na">disconnect</span><span class="p">();</span>
</code></pre></div>
<strong>注1：connect 与 disconnect 必需成对出现，通讯结束时一定要记得断开连接</strong></p>
<p><strong>注2：如果不知道控制器IP地址，请先使用LedshowTW软件设置IP地址，软件下载地址：<a href="https://www.onbonbx.com/download/165.html">https://www.onbonbx.com/download/165.html</a></strong></p>
<h3 id="34">3.4 屏幕控制<a class="headerlink" href="#34" title="Permanent link">&para;</a></h3>
<p>SDK 还提供了一些接口，用于对 屏幕进行一些常用操作。</p>
<h4 id="341">3.4.1 开关机<a class="headerlink" href="#341" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="c1">// 关机</span>
<span class="n">screen</span><span class="p">.</span><span class="na">turnOff</span><span class="p">();</span>
<span class="c1">// 开机</span>
<span class="n">screen</span><span class="p">.</span><span class="na">turnOn</span><span class="p">();</span>
</code></pre></div>

<h4 id="342">3.4.2 校正时钟<a class="headerlink" href="#342" title="Permanent link">&para;</a></h4>
<p>控制器上的时钟不准确时，可以通过此命令对其进行校正。</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// 校时</span>
<span class="n">screen</span><span class="p">.</span><span class="na">syncTime</span><span class="p">();</span>
</code></pre></div>

<h4 id="343">3.4.3 锁定屏幕<a class="headerlink" href="#343" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="c1">// 锁定屏幕当前画面</span>
<span class="n">screen</span><span class="p">.</span><span class="na">lock</span><span class="p">();</span>
<span class="c1">// 解除锁定屏幕当前画面</span>
<span class="n">screen</span><span class="p">.</span><span class="na">unlock</span><span class="p">();</span>
</code></pre></div>

<p>屏幕锁定后，画面将被锁定不动。</p>
<h4 id="344">3.4.4 锁定节目<a class="headerlink" href="#344" title="Permanent link">&para;</a></h4>
<p>节目锁定后，控制器将仅播放当前锁定的节目，不再轮播其它节目。</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// 锁定指定节目</span>
<span class="n">screen</span><span class="p">.</span><span class="na">lockProgram</span><span class="p">(</span><span class="n">programId</span><span class="p">,</span> <span class="n">lockDuration</span><span class="p">);</span>
<span class="c1">// 解除节目锁定</span>
<span class="n">screen</span><span class="p">.</span><span class="na">unlockProgram</span><span class="p">(</span><span class="n">programId</span><span class="p">);</span>
</code></pre></div>

<p>其中，</p>
<p>programId - 节目的 id</p>
<p>lockDuration - 锁定的时间长度，如果为0，则一直锁定</p>
<h4 id="345">3.4.5 查询固件版本<a class="headerlink" href="#345" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="c1">// 查询控制器当前固件版本</span>
<span class="n">screen</span><span class="p">.</span><span class="na">checkFirmware</span><span class="p">();</span>
</code></pre></div>

<h4 id="346">3.4.6 获取控制器状态<a class="headerlink" href="#346" title="Permanent link">&para;</a></h4>
<p>控制器状态中，包含连接在控制器上的传感器的值。如下所示：</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// 通过以下接口回读控制器状态</span>
<span class="n">Bx5GScreen</span><span class="p">.</span><span class="na">Result</span><span class="o">&lt;</span><span class="n">ReturnControllersStatus</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">screen</span><span class="p">.</span><span class="na">checkControllerStatus</span><span class="p">();</span>
<span class="k">if</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">isOK</span><span class="p">()){</span>
    <span class="n">ReturnControllerStatus</span> <span class="n">status</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="na">reply</span><span class="p">;</span>
    <span class="c1">// 取得亮度值</span>
    <span class="n">status</span><span class="p">.</span><span class="na">getBrightness</span><span class="p">();</span>
    <span class="c1">// 取得温度传感器温度值</span>
    <span class="n">status</span><span class="p">.</span><span class="na">getTemperature1</span><span class="p">();</span>
    <span class="c1">// status还有很多接口，根据实际应用进行调用</span>
    <span class="p">...</span>
<span class="p">}</span>
<span class="k">else</span><span class="p">{</span>
    <span class="n">ErrorType</span> <span class="n">error</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="na">getError</span><span class="p">();</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">error</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="35">3.5 节目与区域<a class="headerlink" href="#35" title="Permanent link">&para;</a></h3>
<p>节目主要用于组合屏幕上现实的内容，它由多个区域组成。控制器同一时间只能播放一个节目，它是控制器显示内容可以单独更新的最小单位（除动态区外）。
以下，我们将按步骤创建一个节目，并将其发送到控制器进行显示。</p>
<p>注：此处以五代控制器为例</p>
<p><strong>步骤1：</strong></p>
<p>创建节目文件，如下所示：</p>
<p><div class="codehilite"><pre><span></span><code><span class="c1">// 创建节目文件</span>
<span class="c1">// 第二个参数为显示屏属性，具体可以参照Bx5GScreenProfile类</span>
<span class="n">Bx5GScreenProfile</span> <span class="n">profile</span> <span class="o">=</span> <span class="n">screen</span><span class="p">.</span><span class="na">getProfile</span><span class="p">();</span>
<span class="n">ProgramBxFile</span> <span class="n">p0</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProgramBxFile</span><span class="p">(</span><span class="n">programId</span><span class="p">,</span> <span class="n">profile</span><span class="p">);</span>
<span class="c1">// 关于节目类的其他接口可以参考ProgramBxFile类</span>
</code></pre></div>
其中，programId 为节目的 id，每个节目文件都有一个唯一的id。更新节目时，id 相同的节目会被覆盖。而锁定节目时，也可以使用此 id 来锁定相应的节目。</p>
<p><strong>步骤2：</strong></p>
<p>创建相关区域，并将相关区域添加到节目文件中。</p>
<p>控制器支持的区域有很多种，例如：图文区、时间区、表盘区和传感器区等。其中，最常用的是图文区。图文区可以用于显示文本和图片。文字或图片可以按顺序依次添加到图文区中，而每页数据均可以设置特技方式，停留时间等属性。而创建一个图文区的步骤大致如下：</p>
<ul>
<li>
<p>创建TextCaptionBxArea对象</p>
</li>
<li>
<p>创建TextBxPage或ImageFileBxPage对象</p>
</li>
<li>
<p>将创建好的page对象添加到TextCaptionBxArea中</p>
</li>
</ul>
<p>下例代码，创建一个文本区，并向这个区域中添加一个文本页</p>
<p><div class="codehilite"><pre><span></span><code><span class="c1">// 创建一个图文区</span>
<span class="c1">// 参数为X、Y、width、heigth</span>
<span class="c1">// 注意区域左边和宽度高度，不要越界</span>
<span class="n">TextCaptionBxArea</span> <span class="n">area</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TextCaptionBxArea</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">160</span><span class="p">,</span><span class="mi">64</span><span class="p">);</span>
<span class="c1">// 创建一个数据页，并希望显示“仰邦科技”这几个字</span>
<span class="n">TextBxPage</span> <span class="n">page</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TextBxPage</span><span class="p">(</span><span class="s">&quot;仰邦科技&quot;</span><span class="p">);</span>
<span class="c1">// 将page添加到area中</span>
<span class="n">area</span><span class="p">.</span><span class="na">addPage</span><span class="p">(</span><span class="n">page</span><span class="p">);</span>
<span class="c1">// 将图文区添加到节目中</span>
<span class="n">p0</span><span class="p">.</span><span class="na">addArea</span><span class="p">(</span><span class="n">area</span><span class="p">);</span>
</code></pre></div>
时间区也是比较常用的区域，而时间区的创建过程大致如下：</p>
<ul>
<li>
<p>创建DateTimeBxArea对象</p>
</li>
<li>
<p>设置各时间单元显示格式</p>
</li>
<li>
<p>将DateTimeBxArea添加到节目中</p>
</li>
</ul>
<p>具体代码如下：</p>
<p><div class="codehilite"><pre><span></span><code><span class="c1">// 下面代码创建了一个时间区</span>
<span class="c1">// 注意：只需输入时间区的起始坐标，区域的宽度和高度SDK会根据字体和显示方式自动计算</span>
<span class="n">DateTimeBxArea</span> <span class="n">dtArea</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DateTimeBxArea</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">screen</span><span class="p">.</span><span class="na">getProfile</span><span class="p">());</span>
<span class="c1">// 设置字体</span>
<span class="n">dtArea</span><span class="p">.</span><span class="na">setFont</span><span class="p">(</span><span class="k">new</span> <span class="n">Font</span><span class="p">(</span><span class="s">&quot;宋体&quot;</span><span class="p">,</span><span class="n">Font</span><span class="p">.</span><span class="na">PLAIN</span><span class="p">,</span><span class="mi">12</span><span class="p">));</span>
<span class="c1">// 设置显示颜色</span>
<span class="n">dtArea</span><span class="p">.</span><span class="na">setForeground</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="na">yellow</span><span class="p">);</span>
<span class="c1">// 多行显示还是单行显示</span>
<span class="n">dtArea</span><span class="p">.</span><span class="na">setMultiline</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="c1">// 年月日显示格式</span>
<span class="c1">// 如果不需要显示，设置为null</span>
<span class="n">dtArea</span><span class="p">.</span><span class="na">setDateStyle</span><span class="p">(</span><span class="n">DateStyle</span><span class="p">.</span><span class="na">YYY_MM_DD_1</span><span class="p">);</span>
<span class="n">dtArea</span><span class="p">.</span><span class="na">setTimeStyle</span><span class="p">(</span><span class="n">TimeStyle</span><span class="p">.</span><span class="na">HH_MM_SS_1</span><span class="p">);</span>
<span class="n">dtArea</span><span class="p">.</span><span class="na">setWeekStyle</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<span class="c1">// 将时间区添加到节目中</span>
<span class="n">p0</span><span class="p">.</span><span class="na">addArea</span><span class="p">(</span><span class="n">dtArea</span><span class="p">);</span>
<span class="c1">// 关于DateTimeBxArea类的更多接口，请参考JAVADOC中相关类的说明</span>
</code></pre></div>
<strong>步骤3：</strong></p>
<p>发送更新节目</p>
<p>节目文件创建好后，即可将节目发送到控制器以进行显示。其代码如下所示：</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// 以下为更新节目命令</span>
<span class="n">screen</span><span class="p">.</span><span class="na">WriteProgram</span><span class="p">(</span><span class="n">p0</span><span class="p">);</span>
<span class="c1">// 更新节目还有很多命令，请参考JAVADOC</span>
</code></pre></div>

<h3 id="36">3.6 动态区<a class="headerlink" href="#36" title="Permanent link">&para;</a></h3>
<p>动态区是一种比较特殊的区域（<a href="/zh/dual/dual/#11">关于动态区</a>），其有以下几个主要特点：</p>
<ul>
<li>刷新次数没有限制</li>
<li>内容掉电不保存</li>
<li>独立于节目进行编辑</li>
<li>
<p>可以支持多个区域，且每个区域可以进行单独更新</p>
</li>
<li>
<p>可以和单个活多个节目绑定显示，即作为节目的一个区域进行显示</p>
</li>
<li>可以作为单独一个节目进行独立播放</li>
<li>灵活的控制方式：超时时间控制、是否立即显示灯</li>
</ul>
<p>以下代码创建了一个动态区，将将其更新到控制器上显示。</p>
<p>五代控制器</p>
<p><div class="codehilite"><pre><span></span><code><span class="c1">// 五代控制器动态区（BX-5E系列）</span>
<span class="c1">// BX-5E系列控制卡最高支持4个动态区，当屏幕上需要同时显示多个动态区时，动态区ID不可以相同</span>
<span class="c1">// DynamicBxRule(id,runMode,immediatePlay,timeout);</span>
<span class="c1">// runMode 运行模式</span>
<span class="c1">// 0:循环显示</span>
<span class="c1">// 1:显示完成后静止显示最后一页数据</span>
<span class="c1">// 2:循环显示，超过设定时间后数据仍未更新时不显示</span>
<span class="c1">// 3:循环显示，超过设定时间后数据仍未更新时显示Logo信息</span>
<span class="c1">// 4:循环显示，显示完最后一页后不再显示</span>
<span class="c1">// immediatePlay</span>
<span class="c1">// 0:与异步节目一起播放</span>
<span class="c1">// 1:异步节目停止播放，仅播放动态区</span>
<span class="c1">// 2:当播放完节目编号最高的异步节目后播放该动态区</span>
<span class="n">DynamicBxAreaRule</span> <span class="n">rule</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DynamicBxRule</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="kt">byte</span><span class="p">)</span><span class="mi">0</span><span class="p">,(</span><span class="kt">byte</span><span class="p">)</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
<span class="n">TextCaptionBxArea</span> <span class="n">darea</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TextCaptionBxArea</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">160</span><span class="p">,</span><span class="mi">64</span><span class="p">,</span><span class="n">screen</span><span class="p">.</span><span class="na">getProfile</span><span class="p">());</span>
<span class="n">TextBxPage</span> <span class="n">dapge</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TextBxPage</span><span class="p">(</span><span class="s">&quot;动态区123abc&quot;</span><span class="p">);</span>
<span class="n">darea</span><span class="p">.</span><span class="na">addPage</span><span class="p">(</span><span class="n">dpage</span><span class="p">);</span>
<span class="n">screen</span><span class="p">.</span><span class="na">writeDynamic</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span><span class="n">darea</span><span class="p">);</span>
</code></pre></div>
六代控制器</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// 六代控制器动态区</span>
<span class="n">DynamicBxAreaRule</span> <span class="n">rule</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DynamicBxAreaRule</span><span class="p">();</span>

<span class="c1">// 设定动态区ID，此处ID为0，多个动态区ID不能相同</span>
<span class="n">rule</span><span class="p">.</span><span class="na">setId</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="c1">// 设定异步节目停止播放，仅播放动态区</span>
<span class="c1">// 0:动态区与异步节目一起播放</span>
<span class="c1">// 1:异步节目停止播放，仅播放动态区</span>
<span class="c1">// 2:当播放完节目编号最高的异步节目后播放该动态区</span>
<span class="n">rule</span><span class="p">.</span><span class="na">setImmediatePlay</span><span class="p">((</span><span class="kt">byte</span><span class="p">)</span><span class="mi">1</span><span class="p">);</span>

<span class="c1">// 设定动态区循环播放</span>
<span class="c1">// 0:循环播放</span>
<span class="c1">// 1:显示完成后静置显示最后一页数据</span>
<span class="c1">// 2:循环显示，超过设定时间后仍未更新时不再显示</span>
<span class="c1">// 3:循环显示，超过设定时间后仍未更新时显示Logo信息</span>
<span class="c1">// 4:显示完成最后一页后就不再显示</span>
<span class="n">rule</span><span class="p">.</span><span class="na">setRunMode</span><span class="p">((</span><span class="kt">byte</span><span class="p">)</span><span class="mi">0</span><span class="p">);</span>
<span class="n">DynamicBxArea</span> <span class="n">area</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DynamicBxArea</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">160</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="n">screen</span><span class="p">.</span><span class="na">getProfile</span><span class="p">());</span>
<span class="n">TextBxPage</span> <span class="n">page</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TextBxPage</span><span class="p">(</span><span class="s">&quot;动态区abc&quot;</span><span class="p">);</span>
<span class="n">area</span><span class="p">.</span><span class="na">addPage</span><span class="p">(</span><span class="n">page</span><span class="p">);</span>
<span class="n">screen</span><span class="p">.</span><span class="na">writeDynamic</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span><span class="n">area</span><span class="p">);</span>
</code></pre></div>

<p><strong>注意：对于单双色控制器，区域之间不能出现重叠。</strong></p>
<h2 id="4-server">4. Server模式<a class="headerlink" href="#4-server" title="Permanent link">&para;</a></h2>
<p>Server模式通常应用于广域网或者 GPRS/3G/4G 无线通讯的场合。在SDK中，Bx5GServer/Bx6GServer 对 server进行封装。它实现了控制器与 server 之间的链接维护，心跳解析，上下线提醒等功能。您可以像client模式一样，对广域网上的屏幕进行控制。</p>
<h3 id="41">4.1 模式简介<a class="headerlink" href="#41" title="Permanent link">&para;</a></h3>
<p>Server的使用流程通常如下：</p>
<ul>
<li>初始化API（在一个进程内只需要初始化一次）</li>
<li>建立并启动 Server</li>
<li>设定监听等待屏幕的连线与断线事件</li>
<li>获取在线屏幕</li>
<li>通过相应的 screen 对象对控制器进行相应的操作</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="c1">// 初始化 SDK</span>
<span class="n">Bx5GEnv</span><span class="p">.</span><span class="na">initial</span><span class="p">();</span> 
<span class="c1">// 建立并启动服务器</span>
<span class="c1">// 此端口号为server进行监听的端口号</span>
<span class="c1">// 其必需与控制器参数中设置的 server port 一致</span>
<span class="n">Bx5GServer</span> <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Bx5GServer</span><span class="p">(</span><span class="s">&quot;Hello Screen&quot;</span><span class="p">,</span> <span class="mi">8036</span><span class="p">);</span>
<span class="c1">// 添加监听</span>
<span class="n">server</span><span class="p">.</span><span class="na">addListener</span><span class="p">(</span><span class="k">new</span> <span class="n">ConnectionListener</span><span class="p">());</span>
<span class="c1">// 启动服务器</span>
<span class="n">server</span><span class="p">.</span><span class="na">start</span><span class="p">();</span>

<span class="c1">// </span>
<span class="k">while</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//</span>
    <span class="c1">// 获取在线的控制器列表</span>
    <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Bx5GScreen</span><span class="o">&gt;</span> <span class="n">screens</span> <span class="o">=</span> <span class="p">(</span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Bx5GScreen</span><span class="o">&gt;</span><span class="p">)</span> <span class="n">server</span><span class="p">.</span><span class="na">getOnlineScreens</span><span class="p">();</span>
    <span class="c1">// 对相应的控制器进行操作</span>
    <span class="p">......</span>
<span class="p">}</span>

<span class="c1">// 监听</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ConnectionListener</span> <span class="kd">implements</span> <span class="n">Bx5GServerListener</span> <span class="p">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">connected</span><span class="p">(</span><span class="n">String</span> <span class="n">socketId</span><span class="p">,</span> <span class="n">String</span> <span class="n">controllerAddr</span><span class="p">,</span> <span class="n">Bx5GScreen</span> <span class="n">screen</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// 控制器上线后，会触发此事件</span>
        <span class="n">Result</span><span class="o">&lt;</span><span class="n">ReturnPingStatus</span><span class="o">&gt;</span> <span class="n">result1</span> <span class="o">=</span> <span class="n">screen</span><span class="p">.</span><span class="na">ping</span><span class="p">();</span>
        <span class="n">Result</span><span class="o">&lt;</span><span class="n">ReturnControllerStatus</span><span class="o">&gt;</span> <span class="n">result2</span> <span class="o">=</span> <span class="n">screen</span><span class="p">.</span><span class="na">checkControllerStatus</span><span class="p">();</span>
        <span class="p">......</span>
    <span class="p">}</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">disconnected</span><span class="p">(</span><span class="n">String</span> <span class="n">socketId</span><span class="p">,</span> <span class="n">String</span> <span class="n">controllerAddr</span><span class="p">,</span> <span class="n">Bx5GScreen</span> <span class="n">screen</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// 控制器下线后，会触发此事件</span>
        <span class="p">......</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="42-demo">4.2 Demo说明<a class="headerlink" href="#42-demo" title="Permanent link">&para;</a></h3>
<p>您可以从以下链接获取相应的 demo：</p>
<p><a href="https://github.com/onbonlab/bx.dual.java.server.git">https://github.com/onbonlab/bx.dual.java.server.git</a></p>
<p>此项目主要用于测试仰邦五代和六代网口控制器的服务器模式。其工作方式如下：</p>
<ol>
<li>
<p>服务端启动后，开始等待控制器上线</p>
</li>
<li>
<p>每隔5秒，检查一下在线控制器</p>
</li>
<li>依次发送节目至在线的控制器</li>
<li>如果控制器支持动态区，则更新动态区</li>
</ol>
<p>其主要包含以下一个类：</p>
<ul>
<li>Bx5GTestbench: 五代控制器的测试平台</li>
</ul>
<p>调用方式如下：</p>
<div class="codehilite"><pre><span></span><code><span class="c1">//</span>
<span class="c1">// 获取 testbench 实例</span>
<span class="n">Bx5GTestbench</span> <span class="n">g5tb</span> <span class="o">=</span> <span class="n">Bx5GTestbench</span><span class="p">.</span><span class="na">getInstance</span><span class="p">();</span>

<span class="c1">//</span>
<span class="c1">// run</span>
<span class="n">g5tb</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="mi">8001</span><span class="p">);</span>
</code></pre></div>

<h2 id="5-android">5. Android平台<a class="headerlink" href="#5-android" title="Permanent link">&para;</a></h2>
<h3 id="51">5.1 使用说明<a class="headerlink" href="#51" title="Permanent link">&para;</a></h3>
<p><strong>步骤1:</strong>  导入 sdk</p>
<p>将所有库文件拷贝至 libs 文件夹，并引入工程，如下所示：</p>
<p>在 module 的 build.gradle 中添加如下代码：</p>
<div class="codehilite"><pre><span></span><code>implementation files(&#39;libs/bx05-0.5.0-SNAPSHOT.jar&#39;)
implementation files(&#39;libs/bx05.message-0.5.0-SNAPSHOT.jar&#39;)
implementation files(&#39;libs/bx06-0.6.0-SNAPSHOT.jar&#39;)
implementation files(&#39;libs/bx06.message-0.6.0-SNAPSHOT.jar&#39;)
implementation files(&#39;libs/log4j-1.2.14.jar&#39;)
implementation files(&#39;libs/simple-xml-2.7.1.jar&#39;)
implementation files(&#39;libs/uia-comm-0.3.3.jar&#39;)
implementation files(&#39;libs/uia-utils-0.2.0.jar&#39;)
implementation files(&#39;libs/uia-message-0.6.0.jar&#39;)

implementation(name: &#39;java.awt4a-0.1-release&#39;, ext: &#39;aar&#39;)
</code></pre></div>

<p>在 project 的 build.gradle 中添加如下代码：</p>
<div class="codehilite"><pre><span></span><code>allprojects {
    repositories {
        google()
        jcenter()

        flatDir {
            dirs &#39;libs&#39;
        }
    }
}
</code></pre></div>

<p><strong>步骤2:</strong> sdk 初始化</p>
<p>SDK 初始化在整个 APP 中只能调用一次，因此，我们将其放在 application 的 onCreate() 接口调用。如下所示：</p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyApp</span> <span class="kd">extends</span> <span class="n">Application</span> <span class="p">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">TAG</span><span class="o">=</span><span class="s">&quot;MyApp&quot;</span><span class="p">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">super</span><span class="p">.</span><span class="na">onCreate</span><span class="p">();</span>

        <span class="k">try</span> <span class="p">{</span>
            <span class="c1">// java.awt for android 初始化</span>
            <span class="n">AwtEnv</span><span class="p">.</span><span class="na">link</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
            <span class="c1">// 是否启动抗锯齿</span>
            <span class="n">AwtEnv</span><span class="p">.</span><span class="na">configPaintAntiAliasFlag</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>

            <span class="c1">// 初始化五代</span>
            <span class="n">Bx5GEnv</span><span class="p">.</span><span class="na">initial</span><span class="p">();</span>

            <span class="c1">// 建立 BX6G API 運行環境。</span>
            <span class="n">Bx6GEnv</span><span class="p">.</span><span class="na">initial</span><span class="p">();</span>
            <span class="n">Log</span><span class="p">.</span><span class="na">d</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s">&quot;sdk 6 version:&quot;</span> <span class="o">+</span> <span class="n">Bx6GEnv</span><span class="p">.</span><span class="na">VER_INFO</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">Log</span><span class="p">.</span><span class="na">d</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s">&quot;sdk init error&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>步骤3：</strong> 在 manifest.xml 中添加相关权限</p>
<p>对于网络通讯，必需先在 manifest 文件中申请相关网络访问的权限，否则会出现通讯失败。</p>
<div class="codehilite"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="nt">&lt;manifest</span> <span class="na">xmlns:android=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span>
    <span class="na">package=</span><span class="s">&quot;com.onbonbx.demo&quot;</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- 允许联网 --&gt;</span>
    <span class="c">&lt;!-- 获取GSM（2g）、WCDMA（联通3g）等网络状态的信息 --&gt;</span>
    <span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">&quot;android.permission.INTERNET&quot;</span> <span class="nt">/&gt;</span>
    <span class="c">&lt;!-- 获取wifi网络状态的信息 --&gt;</span>
    <span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">&quot;android.permission.ACCESS_NETWORK_STATE&quot;</span> <span class="nt">/&gt;</span>
    <span class="c">&lt;!-- 获取wifi网络状态的信息 --&gt;</span>
    <span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">&quot;android.permission.ACCESS_WIFI_STATE&quot;</span> <span class="nt">/&gt;</span>
    <span class="c">&lt;!-- 保持CPU 运转，屏幕和键盘灯有可能是关闭的,用于文件上传和下载 --&gt;</span>
    <span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">&quot;android.permission.CHANGE_WIFI_STATE&quot;</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;application</span>
        <span class="na">android:name=</span><span class="s">&quot;.MyApp&quot;</span>
        <span class="na">android:allowBackup=</span><span class="s">&quot;true&quot;</span>
        <span class="na">android:icon=</span><span class="s">&quot;@mipmap/ic_launcher&quot;</span>
        <span class="na">android:label=</span><span class="s">&quot;@string/app_name&quot;</span>
        <span class="na">android:roundIcon=</span><span class="s">&quot;@mipmap/ic_launcher_round&quot;</span>
        <span class="na">android:supportsRtl=</span><span class="s">&quot;true&quot;</span>
        <span class="na">android:theme=</span><span class="s">&quot;@style/AppTheme&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;activity</span> <span class="na">android:name=</span><span class="s">&quot;.MainActivity&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;intent-filter&gt;</span>
                <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">&quot;android.intent.action.MAIN&quot;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;category</span> <span class="na">android:name=</span><span class="s">&quot;android.intent.category.LAUNCHER&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/intent-filter&gt;</span>
        <span class="nt">&lt;/activity&gt;</span>
    <span class="nt">&lt;/application&gt;</span>

<span class="nt">&lt;/manifest&gt;</span>
</code></pre></div>

<p><strong>步骤4：</strong> 在线程中调用相关接口</p>
<p>在 Android 系统中，网络通讯不能放在主线程中调用，而必需另起线程。通常如下：</p>
<div class="codehilite"><pre><span></span><code><span class="k">new</span> <span class="n">Thread</span><span class="p">(</span><span class="k">new</span> <span class="n">Runnable</span><span class="p">()</span> <span class="p">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="p">()</span> <span class="p">{</span>

        <span class="n">Bx5GScreenClient</span> <span class="n">screen</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Bx5GScreenClient</span><span class="p">(</span><span class="s">&quot;screen&quot;</span><span class="p">);</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="c1">// 连接控制器</span>
            <span class="n">screen</span><span class="p">.</span><span class="na">connect</span><span class="p">(</span><span class="n">ip</span><span class="p">.</span><span class="na">getText</span><span class="p">().</span><span class="na">toString</span><span class="p">(),</span> <span class="mi">5005</span><span class="p">);</span>

            <span class="c1">// 获取控制器状态</span>
            <span class="n">screen</span><span class="p">.</span><span class="na">ping</span><span class="p">();</span>

            <span class="c1">// 断开链接</span>
            <span class="n">screen</span><span class="p">.</span><span class="na">disconnect</span><span class="p">();</span>

        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Bx5GException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}).</span><span class="na">start</span><span class="p">();</span>
</code></pre></div>

<h3 id="52-sdkdemo">5.2 获取SDK与DEMO<a class="headerlink" href="#52-sdkdemo" title="Permanent link">&para;</a></h3>
<p>您可以通过如下链接获取 ANDROID SDK 与 DEMO:</p>
<p>b. android demo: </p>
<p><a href="https://github.com/onbonlab/bx.dual.android.git">https://github.com/onbonlab/bx.dual.android.git</a></p>
<p>c. android 串口通讯 sdk 与 demo:</p>
<p><a href="https://github.com/onbonlab/bx.dual.android.serial.git">https://github.com/onbonlab/bx.dual.android.serial.git</a></p>
<h2 id="6">6. 常见问题<a class="headerlink" href="#6" title="Permanent link">&para;</a></h2>
<ol>
<li>逾时未回应问题
 逾时未回应一般是使用的控制卡型号和代码里设置的不一致导致，比如使用的控制卡型号是BX-6E1，在创建Screen对象时候，写的是new Bx6M(),就会导致该问题，SDK提供的型号有:new Bx6Q()/new Bx6M()/newBx6E(),如果使用的控制卡型号，SDK中没有提供，比如BX-6A1，可以使用new Bx6M()替代。创建Screen对象代码如下：
<div class="codehilite"><pre><span></span><code><span class="n">Bx6GScreenClient</span> <span class="n">screen</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Bx6GScreenClient</span><span class="p">(</span><span class="s">&quot;MyScreen&quot;</span><span class="p">,</span><span class="k">new</span> <span class="n">Bx6E</span><span class="p">());</span>
</code></pre></div></li>
<li>连接失败问题
 连接失败时候，可以检查通讯情况，在命令行ping控制卡的IP地址，使用LedshowTW软件和控制卡通讯测试，或者频繁更新节目也会导致连接失败。</li>
<li>表格显示问题
 SDK中不支持直接添加表格显示，需要把表格画成图片，添加到区域中进行显示，图片包括单元格和单元格里的内容，如果，某个单元格中内容有更新，则重新生成图片，替换原来图片显示。</li>
<li>控制卡固件版本查询
 控制卡的固件版本更新可以通过LedshowTW软来更新，设置--控制器程序维护--密码888-查询。在该界面也可以更新固件版本。通过代码查询，查询代码如下：
<div class="codehilite"><pre><span></span><code><span class="n">screen</span><span class="p">.</span><span class="na">checkFirmware</span><span class="p">();</span>
</code></pre></div></li>
<li>动态区关联（绑定）节目
 动态区完全独立于节目更新，但是可以和节目绑定，绑定后动态区可以和节目一起显示，绑定节目代码如下：
<div class="codehilite"><pre><span></span><code><span class="n">DynamicBxAreaRule</span> <span class="n">rule</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DynamicBxAreaRule</span><span class="p">();</span>
<span class="n">rule</span><span class="p">.</span><span class="na">setId</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="n">rule</span><span class="p">.</span><span class="na">setRunMode</span><span class="p">((</span><span class="kt">byte</span><span class="p">)</span><span class="mi">0</span><span class="p">);</span>
<span class="c1">// 新增动态区关联异步节目，一旦关联了节目，则动态区和节目一起播放</span>
<span class="c1">// 设定动态区关联节目</span>
<span class="c1">// true 所有异步节目播放时都播放该动态区</span>
<span class="c1">// false 由规则决定</span>
<span class="n">rule</span><span class="p">.</span><span class="na">setRelativeAllProgram</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="c1">// 规则</span>
<span class="c1">// 设置动态区和节目0绑定</span>
<span class="n">rule</span><span class="p">.</span><span class="na">addRelativeProgram</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</code></pre></div></li>
<li>什么时候用动态区，什么时候用节目
 动态区指的是频繁更新的区域，不是滚动效果，比如停车场车位信息，停车场车牌信息，传感器状态实时展示，车次状态实时更新等，需要使用动态区，节目一般用在一些欢迎标语等很少更新或不更新场合。</li>
<li>汉字显示方块问题
 该问题常见于Linux系统，首先需要确认的是linux系统中是否安装了中文字体，一般情况安装中文字体后即可解决，SDK中设置字体代码如下：
<div class="codehilite"><pre><span></span><code><span class="n">page</span><span class="p">.</span><span class="na">setFont</span><span class="p">(</span><span class="k">new</span> <span class="n">Font</span><span class="p">(</span><span class="s">&quot;宋体&quot;</span><span class="p">,</span><span class="n">Font</span><span class="p">.</span><span class="na">PLAIN</span><span class="p">,</span><span class="mi">12</span><span class="p">));</span>
</code></pre></div></li>
<li>对齐方式设置问题
 SDK提供了一些对齐方式的设置，如果SDK中提过的对齐方式设置不能满足需求，可以把要显示的内容画成图片，在图片上排版，然后添加到区域中进行显示，SDK中对齐方式设置代码如下：
<div class="codehilite"><pre><span></span><code><span class="c1">// 水平对齐方式设置</span>
<span class="c1">// 设置居左对齐</span>
<span class="n">page</span><span class="p">.</span><span class="na">setHorizontalAlignment</span><span class="p">(</span><span class="n">TextBinary</span><span class="p">.</span><span class="na">Alignment</span><span class="p">.</span><span class="na">NEAR</span><span class="p">);</span>
<span class="c1">// 设置居中对齐</span>
<span class="n">page</span><span class="p">.</span><span class="na">setHorizontalAlignment</span><span class="p">(</span><span class="n">TextBinary</span><span class="p">.</span><span class="na">Alignment</span><span class="p">.</span><span class="na">CENTER</span><span class="p">);</span>
<span class="c1">// 设置居右对齐</span>
<span class="n">page</span><span class="p">.</span><span class="na">setHorizontalAlignment</span><span class="p">(</span><span class="n">TextBinary</span><span class="p">.</span><span class="na">Alignment</span><span class="p">.</span><span class="na">FAR</span><span class="p">);</span>
<span class="c1">// 设置垂直对齐方式</span>
<span class="c1">// 设置居上对齐</span>
<span class="n">page</span><span class="p">.</span><span class="na">setVerticalAlignment</span><span class="p">(</span><span class="n">TextBinary</span><span class="p">.</span><span class="na">Alignmet</span><span class="p">.</span><span class="na">NEAR</span><span class="p">);</span>
<span class="c1">// 设置居中对齐</span>
<span class="n">page</span><span class="p">.</span><span class="na">setVerticalAlignment</span><span class="p">(</span><span class="n">TextBinary</span><span class="p">.</span><span class="na">Alignmet</span><span class="p">.</span><span class="na">CENTER</span><span class="p">);</span>
<span class="c1">// 设置居下对齐</span>
<span class="n">page</span><span class="p">.</span><span class="na">setVerticalAlignment</span><span class="p">(</span><span class="n">TextBinary</span><span class="p">.</span><span class="na">Alignmet</span><span class="p">.</span><span class="na">FAR</span><span class="p">);</span>
</code></pre></div></li>
<li>天气显示问题
 SDK中没有提供天气显示相关接口，可以自行获取天气信息数据，排版后添加到动态区来实时更新显示</li>
<li>
<p>服务器模式在监听里写数据和在监听外写数据的区别</p>
</li>
<li>
<p>手动换行显示
 换行显示有2种方式，第一是通过换行符来换行，第二是通过SDK中的接口换行，换行代码如下：
<div class="codehilite"><pre><span></span><code>// 通过换行符换行
TextBxPage page = new TextBxPage(&quot;第一行\r\n第二行&quot;);
// 通过接口换行
TextBxPage page = new TextBxPage(&quot;第一行&quot;);
page.newLine(&quot;第二行&quot;);
</code></pre></div></p>
</li>
<li>区域越界问题
 区域越界指的是区域超出屏幕范围，一般情况下，最右边的区域X+区域宽度大于LED屏宽度，或者最下面区域Y+区域高度大于LED屏高度即为区域越界，如果程序中有判断是否越界，在越界的时候程序会报out of range，如果程序中没有判断是否越界，则有可能导致LED屏显示异常，判断是否越界代码如下：
<div class="codehilite"><pre><span></span><code><span class="k">if</span><span class="p">(</span><span class="n">pf</span><span class="p">.</span><span class="na">validate</span><span class="p">()</span><span class="o">!=</span><span class="kc">null</span><span class="p">){</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;pf out of range&quot;</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></li>
<li>连接问题
 控制卡用的短连接方式通讯，所以，在发送完数据后，需要断开与控制卡的连接，再次发送数据时候，重新连接控制卡，大概步骤如下：
<div class="codehilite"><pre><span></span><code><span class="c1">// 创建连接</span>
<span class="n">screen</span><span class="p">.</span><span class="na">connect</span><span class="p">();</span>
<span class="c1">// 发送数据</span>
<span class="p">......</span>
<span class="c1">// 断开连接</span>
<span class="n">screen</span><span class="p">.</span><span class="na">disconnect</span><span class="p">();</span>
</code></pre></div></li>
<li>其他一些显示异常问题
 显示异常，一般是更新数据相关，可以自行检查program/area/page等对象创建是否有问题，这些对象不可以为空，也不可以是空格，如果需要显示黑屏，可以使用黑色图片。</li>
</ol>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../c/c/" class="btn btn-neutral float-right" title="C">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../../dual/" class="btn btn-neutral" title="开发指南"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright © 2020 onbon. All rights reserved. </p>
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/onbonlab/onbonlab.github.io.git/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../../dual/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../../c/c/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../../../..';</script>
    <script src="../../../../js/theme.js" defer></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
      <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js" defer></script>
      <script src="../../../../js/my.js" defer></script>
      <script src="../../../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
